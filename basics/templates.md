# Шаблоны

**D** позволяет определять шаблонные функции, подобно C++ и Java. Это способ создать **обобщённую** функцию или объект, работающий с любым типом, который компилируется с выражениями в теле функции:

    auto add(T)(T lhs, T rhs) {
        return lhs + rhs;
    }

Параметр шаблона `T` задаётся в паре скобок перед параметрами вызова
функции. `T` - это просто метка, которая заменяется компилятором непосредственно при *инстанцировании* (создании экземпляра) функции с использованием оператора `!`:

    add!int(5, 10);
    add!float(5.0f, 10.0f);
    // следующая строка не скомпилируется,
    // так как Animal не реализует оператор "+"
    add!Animal(dog, cat);

Если шаблонная функция не получает параметр шаблона, компилятор пытается вывести
тип, используя входные параметры, с которыми функция вызывается:

    int a = 5; int b = 10;
    add(a, b); // T выводится как `int`
    float c = 5.0f;
    add(a, c); // ОШИБКА:
               // компилятор не знает, чем
               // должен быть T

Функция может иметь любое число параметров шаблона, заданных при
инстанцировании с использованием синтаксиса `func!(T1, T2 ..)`. Параметры шаблона могут быть любого основного типа, включая строки и числа с плавающей точкой.

В отличие от generics в Java, шаблоны в D существуют исключительно во время компиляции и генерируют высокооптимизированный код, адаптированный под конкретный набор типов, который используетя при фактическом вызове функции.

Типы `struct`, `class` и `interface` также могут быть определены
как шаблонные типы.

    struct S(T) {
        // ...
    }

### Подробнее

- [Руководство по шаблонам в D](https://github.com/PhilippeSigaud/D-templates-tutorial)
- [Шаблоны в _Programming in D_](http://ddili.org/ders/d.en/templates.html)

#### Дополнительно

- [Спецификация на шаблоны](https://dlang.org/spec/template.html)
- [Templates Revisited](http://dlang.org/templates-revisited.html):  Уолтер Брайт пишет о том, как язык D сделал "работу над ошибками", взяв за основу шаблоны C++.
- [Variadic templates](http://dlang.org/variadic-function-templates.html): Статья  о реализации в D вариативных функций с вариативными шаблонами.

## {SourceCode}

```d
import std.stdio;

/**
Шаблонный класс, который разрешает обобщённую
реализацию animals.
Параметры:
    noise = string to write
*/
class Animal(string noise) {
    void makeNoise() {
        writeln(noise ~ "!");
    }
}

class Dog: Animal!("Bark") {
}

class Cat: Animal!("Meeoauw") {
}

/**
Шаблонная функция, которая принимает любой тип T, 
который реализует функцию makeNoise.
Параметры:
    animal = объект, который может создавать шум
    n = количество вызовов makeNoise
*/
void multipleNoise(T)(T animal, int n) {
    for (int i = 0; i < n; ++i) {
        animal.makeNoise();
    }
}

void main() {
    auto dog = new Dog;
    auto cat = new Cat;
    multipleNoise(dog, 5);
    multipleNoise(cat, 5);
}
```
